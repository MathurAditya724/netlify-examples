---
import Layout from '@/layouts/Layout.astro'
import { productNewSnugglePath } from '@/utils/routes'
import { turso } from '../../utils/database'

const { id } = Astro.params;
if (!id) {
  throw new Error("No pet id provided");
}

const data = await turso.execute({ sql: `SELECT * FROM pets WHERE id = ?`, args: [id] })

if (data.rows.length === 0) {
  console.error(`No pet found with id ${id}`)
  throw new Error("No pet found");
}

const currentPet = data.rows[0]

---
<Layout title={`${currentPet.name} | Pets`} indexable={true}>
  <div style={{ margin: "auto auto 100px auto" }}>
    <h1 data-pagefind-meta="title">{currentPet.name}</h1>
    <div>Say hi to {currentPet.name}!</div>
    <div>{currentPet.bio}</div>
    <div>{currentPet.name} has {currentPet.snuggles} snuggle{currentPet.snuggles === 1 ? "" : "s"}! You should give them some more!</div>
    <div style={{width: "250px", margin:"auto"}}>
      <form action={productNewSnugglePath(currentPet)} method="post">
        <button type="submit">Give Snuggle</button>
      </form>
    </div>
    <img src={`/.netlify/images?url=/images/${currentPet.image}&w=1500&h=1000&fit=cover`} alt={currentPet.name} />
  </div>
</Layout>

<style>
  .page-header {
    text-align: center;
  }

  h1 {
    margin: 0 0 2rem;
    padding: 0;
  }

  span {
    background-color: var(--neutral-dark-900);
    border-radius: 0.25rem;
    display: inline-block;
    font-size: 0.85rem;
    line-height: 1;
    margin-bottom: 0.5rem;
    padding: 0.5rem;
  }

  .bio {
    font-size: 1.5rem;
  }

  h3 {
    margin-bottom: 1rem;
    padding: 0;
    font-size: 1.5rem;
  }

  img {
    border-radius: 0.5rem;
    display: block;
    width: 100%;
  }
</style>